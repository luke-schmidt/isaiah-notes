% Isaiah Bible Study Environments
% Major environments for biblical analysis and formatting

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{environments}[2025/01/01 Isaiah Environments Package]

% Command for the main section with border and optional header
\newenvironment{biblicaloutline}[1][]{%
    \par\vspace{15pt}%
    \def\bibheader{#1}%
    % Create the bordered content box with optional header overlay
    \begin{tikzpicture}[baseline=(current bounding box.north)]
    \node[
        draw=bordercolor,
        line width=1.5pt,
        rounded corners=10pt,
        inner sep=15pt,
        text width=\linewidth-30pt,
        anchor=north west
    ] (box) at (0,0) \bgroup
    \begin{minipage}{\linewidth-30pt}
    \vspace{1pt}
}{%
    \vspace{10pt}
    \end{minipage}
    \egroup;
    % If header is provided, overlay it on the border
    \ifx\bibheader\empty
        % No header provided
    \else
        \node[fill=white, anchor=west] at ([xshift=20pt]box.north west) {\Large\bfseries\,\bibheader\,};
    \fi
    \end{tikzpicture}
    \par\vspace{10pt}%
}

% Environment for verse sections with optional left marker and built-in poetry
\newenvironment{versesection}[2][]{%
    \par\noindent%
    \begin{minipage}[c]{0.08\linewidth}
        \ifx&#1&%
            % No marker
        \else
            \centering\textbf{\large #1}
        \fi
    \end{minipage}%
    \begin{minipage}[c]{0.92\linewidth}
    \begin{list}{}{%
        \setlength{\leftmargin}{0pt}%
        \setlength{\rightmargin}{0pt}%
        \setlength{\listparindent}{0pt}%
        \setlength{\itemindent}{0pt}%
        \setlength{\parsep}{0pt}%
        \setlength{\topsep}{0pt}%
        \setlength{\itemsep}{0pt}%
    }%
    \item[]%
    \def\poetryindent{#2}%
    \ifx&#2&\def\poetryindent{2em}\fi% Default to 2em if not specified
    \obeylines%
    % Define alternating indent commands
    \newcommand{\poetryline}{\hspace*{\poetryindent}}%
}{%
    \end{list}%
    \end{minipage}%
    \par\vspace{8pt}%
}

% Custom indentation environment for subsections
\newenvironment{indentedsubsection}[1][20pt]{%
    \begin{list}{}{%
        \setlength{\leftmargin}{#1}%
        \setlength{\rightmargin}{0pt}%
        \setlength{\listparindent}{0pt}%
        \setlength{\itemindent}{0pt}%
        \setlength{\parsep}{0pt}%
        \setlength{\topsep}{0pt}%
    }%
    \item[]%
}{%
    \end{list}%
}

% Chiastic structure environment with automatic indentation levels (page-breakable)
\newenvironment{chiasticoutline}[3][]{%
    \par\vspace{15pt}%
    \def\bibheader{#1}%
    \def\chiasticindent{#2}% Base indentation unit (e.g., 1em)
    \def\poetryindentunit{#3}% Poetry line indentation (e.g., 2em)
    % Create the mdframed environment with optional header
    \ifx\bibheader\empty
        \begin{mdframed}[
            linewidth=1.5pt,
            linecolor=bordercolor,
            roundcorner=10pt,
            tikzsetting={rounded corners=10pt},
            innerleftmargin=15pt,
            innerrightmargin=15pt,
            innertopmargin=15pt,
            innerbottommargin=15pt
        ]
    \else
        \begin{mdframed}[
            linewidth=1.5pt,
            linecolor=bordercolor,
            roundcorner=10pt,
            tikzsetting={rounded corners=10pt},
            innerleftmargin=15pt,
            innerrightmargin=15pt,
            innertopmargin=15pt,
            innerbottommargin=15pt,
            frametitle={\Large\bfseries\,\bibheader\,},
            frametitleaboveskip=10pt,
            frametitlealignment=\raggedright
        ]
    \fi
    % Define chiastic versesection command
    % Usage: \chiasticverse[marker]{level}{content} or \chiasticverselabel[marker]{level}{content}{sublabel}
    \newcommand{\chiasticverse}[3][]{%
        % ##1 = marker, ##2 = level (A=0, B=1, C=2, etc.), ##3 = content
        \par\noindent%
        \hspace*{##2\chiasticindent}%
        \begin{minipage}[c]{0.08\linewidth}
            \ifx&##1&%
                % No marker
            \else
                \centering\textbf{\large ##1}%
            \fi
        \end{minipage}%
        \begin{minipage}[c]{\dimexpr0.92\linewidth-##2\chiasticindent\relax}
        \begin{list}{}{%
            \setlength{\leftmargin}{0pt}%
            \setlength{\rightmargin}{0pt}%
            \setlength{\listparindent}{0pt}%
            \setlength{\itemindent}{0pt}%
            \setlength{\parsep}{0pt}%
            \setlength{\topsep}{0pt}%
            \setlength{\itemsep}{0pt}%
        }%
        \item[]%
        \obeylines%
        \newcommand{\poetryline}{\hspace*{\poetryindentunit}}%
        ##3%
        \end{list}%
        \end{minipage}%
        \par\vspace{8pt}%
    }%
    % Define chiastic versesection command with sublabel
    % Usage: \chiasticverselabel[marker]{level}{content}{sublabel}
    \newcommand{\chiasticverselabel}[4][]{%
        % ##1 = marker, ##2 = level (A=0, B=1, C=2, etc.), ##3 = content, ##4 = sublabel
        \par\noindent%
        \hspace*{##2\chiasticindent}%
        \begin{minipage}[c]{0.08\linewidth}
            \ifx&##1&%
                % No marker
            \else
                \centering\textbf{\large ##1}%
                \\[2pt]\centering\textit{\small ##4}%
            \fi
        \end{minipage}%
        \begin{minipage}[c]{\dimexpr0.92\linewidth-##2\chiasticindent\relax}
        \begin{list}{}{%
            \setlength{\leftmargin}{0pt}%
            \setlength{\rightmargin}{0pt}%
            \setlength{\listparindent}{0pt}%
            \setlength{\itemindent}{0pt}%
            \setlength{\parsep}{0pt}%
            \setlength{\topsep}{0pt}%
            \setlength{\itemsep}{0pt}%
        }%
        \item[]%
        \obeylines%
        \newcommand{\poetryline}{\hspace*{\poetryindentunit}}%
        ##3%
        \end{list}%
        \end{minipage}%
        \par\vspace{8pt}%
    }%
}{%
    \end{mdframed}
    \par\vspace{10pt}%
}

% Overview environment for chapter summaries
\newenvironment{overview}[1]{%
    \par\vspace{15pt}%
    % Create the main overview box
    \begin{tikzpicture}
    \node[
        draw=black!60,
        line width=2.5pt,
        rounded corners=15pt,
        inner sep=15pt,
        text width=\linewidth-30pt,
        anchor=north west,
        top color=blue!8,
        bottom color=blue!3,
        drop shadow
    ] at (0,0) \bgroup
    \begin{minipage}{\linewidth-30pt}
    % Header with blue text on gradient background
    \vspace{-8pt}
    \textcolor{highlightblue}{\bfseries\LARGE\,#1\,}
    \vspace{12pt}
    
    % Define section command for overview items
    \newcommand{\overviewsection}[2][0]{%
        \par\vspace{10pt}
        % Create section box with proper indentation
        \hspace*{##1\dimexpr 20pt\relax}
        \begin{tikzpicture}
        \node[
            draw=black!50,
            line width=2pt,
            rounded corners=10pt,
            inner sep=12pt,
            text width=\dimexpr\linewidth-30pt-##1\dimexpr 20pt\relax-##1\dimexpr 20pt\relax,
            anchor=north west,
            top color=white,
            bottom color=blue!5,
            drop shadow={opacity=0.3}
        ] at (0,0) \bgroup
        \begin{minipage}{\dimexpr\linewidth-30pt-##1\dimexpr 20pt\relax-##1\dimexpr 20pt\relax}
        ##2
        \end{minipage}
        \egroup;
        \end{tikzpicture}
        \par
    }
    
    % Define bold section command for emphasis
    \newcommand{\overviewsectionbold}[2][0]{%
        \par\vspace{10pt}
        % Create section box with proper indentation and thicker border
        \hspace*{##1\dimexpr 20pt\relax}
        \begin{tikzpicture}
        \node[
            draw=black!70,
            line width=3.5pt,
            rounded corners=10pt,
            inner sep=12pt,
            text width=\dimexpr\linewidth-30pt-##1\dimexpr 20pt\relax-##1\dimexpr 20pt\relax,
            anchor=north west,
            top color=white,
            bottom color=blue!5,
            drop shadow={opacity=0.4}
        ] at (0,0) \bgroup
        \begin{minipage}{\dimexpr\linewidth-30pt-##1\dimexpr 20pt\relax-##1\dimexpr 20pt\relax}
        ##2
        \end{minipage}
        \egroup;
        \end{tikzpicture}
        \par
    }
}{%
    \vspace{10pt}
    \end{minipage}
    \egroup;
    \end{tikzpicture}
    \par\vspace{15pt}%
}

% Comparison table environment for parallel passages
\newenvironment{comparisontable}[3]{%
    \par\vspace{10pt}%
    \begin{center}
    \begin{tabular}{|p{0.4\linewidth}|p{0.4\linewidth}|p{0.2\linewidth}|}
    \hline
    \textbf{#1} & \textbf{#2} & \textbf{#3} \\
    \hline
}{%
    \end{tabular}
    \end{center}
    \par\vspace{10pt}%
}

% Command for table rows with verse content
\newcommand{\verserow}[3]{%
    \begin{minipage}[t]{\linewidth}
    \vspace{2pt}
    #1
    \vspace{2pt}
    \end{minipage} & 
    \begin{minipage}[t]{\linewidth}
    \vspace{2pt}
    #2
    \vspace{2pt}
    \end{minipage} & 
    \begin{minipage}[t]{\linewidth}
    \vspace{2pt}
    #3
    \vspace{2pt}
    \end{minipage} \\
    \hline
}

\endinput